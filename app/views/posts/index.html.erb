<h1>Timeline</h1>

<% if logged_in? %>
  <div class="filter-tabs">
    <%= link_to "My Timeline", posts_path(filter: 'timeline'), class: "tab #{'active' if @filter == 'timeline'}" %>
    <%= link_to "My Posts", posts_path(filter: 'mine'), class: "tab #{'active' if @filter == 'mine'}" %>
    <%= link_to "Following", posts_path(filter: 'following'), class: "tab #{'active' if @filter == 'following'}" %>
  </div>

  <div class="post-form-container" data-controller="character-counter">
    <%= form_with model: @post, url: posts_path, local: true, class: "post-form" do |f| %>
      <%= f.text_area :content, placeholder: "What's on your mind? (max 200 characters)", maxlength: 200, rows: 3, class: "post-content", data: { character_counter_target: "input" } %>
      <div class="post-form-footer">
        <span class="char-counter"><span data-character-counter-target="counter">0</span>/200</span>
        <%= f.submit "Post", class: "btn btn-primary" %>
      </div>
    <% end %>
  </div>
<% else %>
  <p class="info">You're viewing public posts. Log in to see your personalized timeline.</p>
<% end %>

<div class="posts-list">
  <% if @posts.any? %>
    <% @posts.each do |post| %>
      <%= render 'posts/post', post: post %>
    <% end %>

    <% if @has_next %>
      <div class="pagination-container">
        <%= link_to "Load More", posts_path(filter: @filter, cursor: @next_cursor),
            class: "btn btn-secondary load-more-btn" %>
      </div>
    <% end %>
  <% else %>
    <div class="empty-state">
      <p>No posts yet. <%= "Be the first to post!" if !logged_in? %></p>
    </div>
  <% end %>
</div>

